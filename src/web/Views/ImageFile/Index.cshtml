@using OxxCommerceStarterKit.Web.Helpers
@model OxxCommerceStarterKit.Web.Models.ViewModels.ImageViewModel
@{
	Layout = null;
    
    // Note! This view requires that the Model.Url is not
    // using the edit/preview url in order to append the
    // size to it.
    
	if (!string.IsNullOrEmpty(Model.Tag))
	{
		Model.Url += Html.GetImageWidth(Model.Tag);
	}

    string imageMapOptionsVarName = "imOpt" + Model.UniqueId;
    string imageMapDataVarName = "imData" + Model.UniqueId;
}
@if (!string.IsNullOrEmpty(Model.ExternalLink))
{
	<a href="@Model.ExternalLink" @(string.IsNullOrEmpty(Model.ExternalLinkTarget) ? "" : "target=" + Model.ExternalLinkTarget)>
        @Image(imageMapDataVarName, imageMapOptionsVarName)
	</a>
}
else
{
	@Image(imageMapDataVarName, imageMapOptionsVarName)
}
@if (!string.IsNullOrEmpty(Model.Description))
{
	<div class="image-description">@Model.Description</div>
}

@helper Image(string imageMapDataVarName, string imageMapOptionsVarName)
{
	if (Model.HotSpots != null && Model.HotSpots.Any())
	{
		var imageMapId = Guid.NewGuid().ToString();
		<div class="hotspotimage @Model.Language" data-mobile="@Model.IsMobile">
			<div class="hotspots">
				@foreach (var hotSpot in Model.HotSpots)
				{
					bool isProduct = hotSpot.IsProduct;
					if (!string.IsNullOrEmpty(hotSpot.link))
					{
						<a class="hotspot" style="display: none;"
						   data-top="@hotSpot.hotSpot.top.ToString().Replace(",", ".")"
						   data-left="@hotSpot.hotSpot.left.ToString().Replace(",", ".")"
						   data-width="@hotSpot.hotSpot.width"
						   data-height="@hotSpot.hotSpot.height"
						   data-area-top="@hotSpot.area.top.ToString().Replace(",", ".")"
						   data-area-left="@hotSpot.area.left.ToString().Replace(",", ".")"
						   data-area-width="@hotSpot.area.width.ToString().Replace(",", ".")"
						   data-area-height="@hotSpot.area.height.ToString().Replace(",", ".")"
						   href="@(isProduct ? "javascript:;" : @Url.ContentUrl(hotSpot.ContentLink))" @(isProduct ? "data-product-id=" + hotSpot.link : "")>
						</a>
					}
				}
			</div>
			<img src="@Model.Url" alt="@(string.IsNullOrEmpty(Model.Description) ? Model.Name : Model.Description)" title="@Model.Copyright" class="image-file img-responsive" usemap="#@imageMapId" />
			<map name="@imageMapId">@* generated by javascript *@</map>
		</div>
	}
    else if(string.IsNullOrEmpty(Model.MerchandiseImageMap) == false)
    {
<script language="javascript">

    var @imageMapDataVarName = @Html.Raw(Model.MerchandiseImageMap);
    var @imageMapOptionsVarName = {
        imageMapData: @imageMapDataVarName,
        spotBackgroundColor: "#333333",
        spotForegroundColor: "#ffffff",
        onClick: function (area, e) {
            console.log("Clicked: " + area.entityId);
        }
    };

</script>
<img src="@Model.Url" onload="InRiverImageMap.initImageMap($(this), @imageMapOptionsVarName)" alt="@(string.IsNullOrEmpty(Model.Description) ? Model.Name : Model.Description)" title="@Model.Copyright" class="image-file img-responsive" />    
}
	else
	{
		<img src="@Model.Url" data-src="@Model.Url" alt="@(string.IsNullOrEmpty(Model.Description) ? Model.Name : Model.Description)" title="@Model.Copyright" class="image-file img-responsive" />
	}

}